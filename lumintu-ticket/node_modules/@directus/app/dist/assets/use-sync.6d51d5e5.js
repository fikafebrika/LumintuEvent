var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,n,l)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,s=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&i(e,n,t[n]);if(l)for(var n of l(t))r.call(t,n)&&i(e,n,t[n]);return e};"undefined"!=typeof require&&require;import{l as u,ac as o,Y as c,y as v,o as d,z as f,an as g}from"./vendor.162b55e9.js";function p(e){return e}function m(e){return e}function _(e){return e}function b(e){return e}function h(e){return e}function y(e){return e}function w(e){return e}function x(e){const t=[];for(const l of e){const{field:e,operator:n}=u.exports.clone(l);let{value:a}=u.exports.clone(l);if(["empty","nempty","null","nnull"].includes(n)&&(a=!0),void 0!==a)if(e.includes(".")){let l={[`_${n}`]:a};const r=e.split(".");for(const e of r.reverse())l={[e]:l};t.push(l)}else t.push({[e]:{[`_${n}`]:a}})}let n={};return 1===t.length&&void 0!==t[0]?n=t[0]:t.length>1&&(n={_and:t}),{filter:n}}const E=o.extend({type:"string",base:o.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate:(e,t,{substring:n})=>!1===e.includes(n)?t.error("string.contains",{substring:n}):e},ncontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate:(e,t,{substring:n})=>!0===e.includes(n)?t.error("string.ncontains",{substring:n}):e}}}),$={requireAll:!1};function O(e,t){var n,l;e=e||{},t=u.exports.merge({},$,t);const a={},r=Object.keys(e)[0];if(!r)throw new Error(`[generateJoi] Filter doesn't contain field key. Passed filter: ${JSON.stringify(e)}`);const i=Object.values(e)[0];if(!i)throw new Error(`[generateJoi] Filter doesn't contain filter rule. Passed filter: ${JSON.stringify(e)}`);if(!1===(null===(n=Object.keys(i)[0])||void 0===n?void 0:n.startsWith("_")))a[r]=E.object({[r]:O(i,t)});else{const e=Object.keys(i)[0],t=Object.values(i)[0],n=()=>{var e;return null!==(e=a[r])&&void 0!==e?e:E.any()},l=()=>{var e;return null!==(e=a[r])&&void 0!==e?e:E.string()},s=()=>{var e;return null!==(e=a[r])&&void 0!==e?e:E.number()},o=()=>{var e;return null!==(e=a[r])&&void 0!==e?e:E.date()};if("_eq"===e&&(a[r]=n().equal(t)),"_neq"===e&&(a[r]=n().not(t)),"_contains"===e&&(a[r]=l().contains(t)),"_ncontains"===e&&(a[r]=l().ncontains(t)),"_starts_with"===e&&(a[r]=l().pattern(new RegExp(`^${u.exports.escapeRegExp(t)}.*`),{name:"starts_with"})),"_nstarts_with"===e&&(a[r]=l().pattern(new RegExp(`^${u.exports.escapeRegExp(t)}.*`),{name:"starts_with",invert:!0})),"_ends_with"===e&&(a[r]=l().pattern(new RegExp(`.*${u.exports.escapeRegExp(t)}$`),{name:"ends_with"})),"_nends_with"===e&&(a[r]=l().pattern(new RegExp(`.*${u.exports.escapeRegExp(t)}$`),{name:"ends_with",invert:!0})),"_in"===e&&(a[r]=n().equal(...t)),"_nin"===e&&(a[r]=n().not(...t)),"_gt"===e&&(a[r]=Number.isSafeInteger(t)?s().greater(t):o().greater(t)),"_gte"===e&&(a[r]=Number.isSafeInteger(t)?s().min(t):o().min(t)),"_lt"===e&&(a[r]=Number.isSafeInteger(t)?s().less(t):o().less(t)),"_lte"===e&&(a[r]=Number.isSafeInteger(t)?s().max(t):o().max(t)),"_null"===e&&(a[r]=n().valid(null)),"_nnull"===e&&(a[r]=n().invalid(null)),"_empty"===e&&(a[r]=n().valid("")),"_nempty"===e&&(a[r]=n().invalid("")),"_between"===e)if(t.every((e=>Number.isSafeInteger(e)))){const e=t;a[r]=s().greater(e[0]).less(e[1])}else{const e=t;a[r]=o().greater(e[0]).less(e[1])}if("_nbetween"===e)if(t.every((e=>Number.isSafeInteger(e)))){const e=t;a[r]=s().less(e[0]).greater(e[1])}else{const e=t;a[r]=o().less(e[0]).greater(e[1])}if("_submitted"===e&&(a[r]=n().required()),"_regex"===e){const e=t.startsWith("/")&&t.endsWith("/");a[r]=l().regex(new RegExp(e?t.slice(1,-1):t))}}return a[r]=null!==(l=a[r])&&void 0!==l?l:E.any(),t.requireAll&&(a[r]=a[r].required()),E.object(a).unknown()}function S(e){if(null===e)return[];let t=e.match(/{{(.*?)}}/g);return Array.isArray(t)?(t=t.map((e=>e.replace(/{{/g,"").replace(/}}/g,"").trim())),t):[]}function j(e){var t,n,l;const{relation:a,collection:r,field:i}=e;return a?a.collection===r&&a.field===i&&(null===(t=a.meta)||void 0===t?void 0:t.one_collection_field)&&(null===(n=a.meta)||void 0===n?void 0:n.one_allowed_collections)?"m2a":a.collection===r&&a.field===i?"m2o":a.related_collection===r&&(null===(l=a.meta)||void 0===l?void 0:l.one_field)===i?"o2m":null:null}const q="stores",R="api";function F(){const e=c("stores");if(!e)throw new Error("[useStores]: The stores could not be found.");return e}function I(){const e=c("api");if(!e)throw new Error("[useApi]: The api could not be found.");return e}function N(e){const{useCollectionsStore:t,useFieldsStore:n}=F(),l=t(),a=n(),r="string"==typeof e?v(e):e,i=d((()=>l.collections.find((({collection:e})=>e===r.value))||null)),s=d((()=>r.value?a.getFieldsForCollection(r.value):[])),u=d((()=>{var e;if(!s.value)return{};const t={};for(const n of s.value)(null===(e=n.schema)||void 0===e?void 0:e.default_value)&&(t[n.field]=n.schema.default_value);return t})),o=d((()=>s.value.find((e=>{var t;return e.collection===r.value&&!0===(null===(t=e.schema)||void 0===t?void 0:t.is_primary_key)}))||null)),c=d((()=>{var e;return(null===(e=s.value)||void 0===e?void 0:e.find((e=>{var t;return((null===(t=e.meta)||void 0===t?void 0:t.special)||[]).includes("user_created")})))||null})),f=d((()=>{var e,t;return(null===(t=null===(e=i.value)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.sort_field)||null})),g=d((()=>{var e,t;return!0===(null===(t=null===(e=i.value)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.singleton)})),p=d((()=>i.value&&i.value.meta?i.value.meta.accountability:null));return{info:i,fields:s,defaults:u,primaryKeyField:o,userCreatedField:c,sortField:f,isSingleton:g,accountabilityScope:p}}function P(e,l,a=!0){const r=I(),{primaryKeyField:i,sortField:o}=N(e);let c=null;const{limit:p,fields:m,sort:_,page:b,filters:h,searchQuery:y}=l,w=d((()=>e.value?e.value.startsWith("directus_")?`/${e.value.substring(9)}`:`/items/${e.value}`:null)),E=v([]),$=v(!1),O=v(null),S=v(null),j=v(null),q=d((()=>null===S.value||S.value<p.value?1:Math.ceil(S.value/p.value)));return a&&R(),f(e,(async(e,t)=>{t&&!u.exports.isEqual(e,t)&&(await g(),E.value=[],j.value=null,S.value=null,R())}),{immediate:a}),f([b,m],(async(e,t)=>{t&&!u.exports.isEqual(e,t)&&(await g(),!1===$.value&&R())})),f(_,(async(e,t)=>{if(!t||u.exports.isEqual(e,t))return;p.value>(S.value||0)?function(e){const t=e.startsWith("-")?e.substring(1):e,n=e.startsWith("-");E.value=u.exports.orderBy(E.value,[t],[n?"desc":"asc"])}(e):(await g(),!1===$.value&&R())})),f([h,p],(async(e,t)=>{t&&!u.exports.isEqual(e,t)&&(b.value=1,await g(),!1===$.value&&R())})),f(y,u.exports.throttle((async(e,t)=>{u.exports.isEqual(e,t)||(b.value=1,await g(),!1===$.value&&R())}),500,{trailing:!0})),{itemCount:S,totalCount:j,items:E,totalPages:q,loading:$,error:O,changeManualSort:async function({item:t,to:n}){var l;const a=null===(l=i.value)||void 0===l?void 0:l.field;if(!a)return;const s=E.value.findIndex((e=>e[a]===t)),u=E.value.findIndex((e=>e[a]===n));E.value=function(e,t,n){const l=e[t],a=e.length,r=t-n;if(void 0===l)return e;if(r>0)return[...e.slice(0,n),l,...e.slice(n,t),...e.slice(t+1,a)];if(r<0){const r=n+1;return[...e.slice(0,t),...e.slice(t+1,r),l,...e.slice(r,a)]}return e}(E.value,s,u);const o=d((()=>`/utils/sort/${e.value}`));await r.post(o.value,{item:t,to:n})},getItems:R};async function R(){if(c||!w.value)return;O.value=null,c=window.setTimeout((()=>{$.value=!0}),250);let l=[...m.value];if(!1===m.value.includes("*")&&i.value&&!1===l.includes(i.value.field)&&l.push(i.value.field),!1===m.value.includes("*")&&h.value.forEach((e=>{!1===l.includes(e.field)&&l.push(e.field)})),!1===m.value.includes("*")&&o.value&&_.value){const e=_.value.startsWith("-")?_.value.substring(1):_.value;!1===l.includes(e)&&l.push(e)}l=l.filter((e=>!1===e.startsWith("$")));try{const a=await r.get(w.value,{params:s({limit:p.value,fields:l,sort:_.value,page:b.value,search:y.value},x(h.value))});let u=a.data.data;"directus_files"===e.value&&(u=u.map((e=>{return l=s({},e),t(l,n({$thumbnail:e}));var l}))),E.value=u,S.value=a.data.data.length,0===u.length&&1!==b.value&&(b.value=1),async function(){if(!i.value||!w.value)return;const e=await r.get(w.value,{params:s({limit:0,fields:i.value.field,meta:["filter_count","total_count"],search:y.value},x(h.value))});j.value=e.data.meta.total_count,S.value=e.data.meta.filter_count}()}catch(a){O.value=a}finally{clearTimeout(c),c=null,$.value=!1}}}function W(e,t,n){return d({get:()=>e[t],set(e){n(`update:${t}`,e)}})}export{R as A,q as S,j as a,W as b,S as c,b as d,w as e,x as f,O as g,m as h,p as i,_ as j,P as k,h as l,y as m,F as n,I as o,N as u};
